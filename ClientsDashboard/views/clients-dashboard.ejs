<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Dashboard - QOLAE Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-left: 6px solid #4facfe;
        }
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
        }
        .logo-section {
            flex: 1;
        }
        .logo {
            font-size: 3rem;
            font-weight: 700;
            color: #4facfe;
            margin-bottom: 8px;
        }
        .tagline {
            color: #6c7293;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        .security-badges {
            display: flex;
            gap: 12px;
        }
        .badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .badge-secure {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
        }
        .badge-gdpr {
            background: linear-gradient(135deg, #0984e3, #74b9ff);
            color: white;
        }
        .badge-blockchain {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            color: white;
        }
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .notification-bell {
            position: relative;
            cursor: pointer;
            padding: 12px;
            background: #f7fafc;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        .notification-bell:hover {
            background: #e8f0ff;
            transform: translateY(-2px);
        }
        .notification-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }
        .welcome-section {
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);
            padding: 25px;
            border-radius: 15px;
            border-left: 4px solid #4facfe;
        }
        .welcome-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }
        .welcome-subtitle {
            color: #6c7293;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        .session-info {
            display: flex;
            gap: 30px;
            font-size: 0.9rem;
            color: #6c7293;
        }
        .session-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .progress-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .progress-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 30px;
        }
        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }
        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        .step-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        .step-circle.active {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
            animation: pulse-step 2s infinite;
        }
        .step-circle.completed {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
        }
        .step-circle.pending {
            background: #e2e8f0;
            color: #a0aec0;
        }
        .step-label {
            font-size: 0.85rem;
            color: #6c7293;
            text-align: center;
            max-width: 80px;
        }
        .progress-line {
            position: absolute;
            top: 25px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e2e8f0;
            z-index: 1;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            border-radius: 1px;
            transition: width 0.8s ease;
        }
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .workflow-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .workflow-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }
        .card-icon svg {
            width: 28px;
            height: 28px;
        }
        .card-icon.consent {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }
        .card-icon.documents {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        .card-icon.appointment {
            background: linear-gradient(135deg, #ffd89b, #19547b);
        }
        .card-icon.report {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
        }
        .card-icon.support {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
        }
        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2d3748;
        }
        .card-description {
            color: #6c7293;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        .card-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .btn-primary {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
        }
        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 1px solid #e2e8f0;
        }
        .btn-warning {
            background: linear-gradient(135deg, #ffd89b, #19547b);
            color: white;
        }
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 15px;
        }
        .status-pending {
            background: #fff5f5;
            color: #c53030;
            border: 1px solid #fed7d7;
        }
        .status-active {
            background: #f0fff4;
            color: #38a169;
            border: 1px solid #c6f6d5;
        }
        .status-completed {
            background: #ebf8ff;
            color: #3182ce;
            border: 1px solid #bee3f8;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: blink 2s infinite;
        }
        .status-pending .status-dot {
            background: #c53030;
        }
        .status-active .status-dot {
            background: #38a169;
        }
        .status-completed .status-dot {
            background: #3182ce;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideIn 0.3s;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #2d3748;
        }
        .close-btn {
            font-size: 2rem;
            color: #a0aec0;
            cursor: pointer;
            border: none;
            background: none;
            transition: color 0.3s;
        }
        .close-btn:hover {
            color: #2d3748;
        }
        .consent-form {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            background: #f7fafc;
            max-height: 300px;
            overflow-y: auto;
        }
        .consent-form h3 {
            color: #2d3748;
            margin-bottom: 10px;
        }
        .consent-form p {
            color: #6c7293;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        .signature-section {
            margin: 20px 0;
        }
        .signature-canvas {
            border: 2px dashed #4facfe;
            border-radius: 10px;
            width: 100%;
            height: 150px;
            cursor: crosshair;
            background: white;
        }
        .signature-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
        }
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        .checkbox-group label {
            color: #2d3748;
            font-weight: 500;
        }
        
        /* Notification Panel */
        .notification-panel {
            display: none;
            position: fixed;
            top: 80px;
            right: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            width: 350px;
            max-height: 500px;
            overflow-y: auto;
            z-index: 999;
            animation: slideInRight 0.3s;
        }
        .notification-panel.show {
            display: block;
        }
        .notification-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .notification-item {
            padding: 15px 20px;
            border-bottom: 1px solid #f7fafc;
            transition: background 0.2s;
            cursor: pointer;
        }
        .notification-item:hover {
            background: #f7fafc;
        }
        .notification-item.unread {
            background: #f0fff4;
        }
        .notification-time {
            font-size: 0.75rem;
            color: #a0aec0;
            margin-top: 5px;
        }
        
        /* Notification Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 1001;
            max-width: 350px;
        }
        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }
        .toast-success {
            background: linear-gradient(135deg, #00b894, #00cec9);
        }
        .toast-info {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }
        .toast-warning {
            background: linear-gradient(135deg, #ffd89b, #19547b);
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes slideInRight {
            from { transform: translateX(50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        @keyframes pulse-step {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .footer-notice {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #ffd89b;
        }
        .notice-content {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #744210;
            font-size: 0.9rem;
        }
        .footer-links {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        .copyright {
            color: #6c7293;
            font-size: 0.9rem;
        }
        .footer-nav {
            display: flex;
            gap: 25px;
        }
        .footer-nav a {
            color: #4facfe;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }
        .footer-nav a:hover {
            color: #2d3748;
        }
        
        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            .header-top {
                flex-direction: column;
                gap: 20px;
            }
            .session-info {
                flex-direction: column;
                gap: 10px;
            }
            .progress-steps {
                flex-wrap: wrap;
                gap: 15px;
                justify-content: center;
            }
            .progress-line {
                display: none;
            }
            .card-buttons {
                flex-direction: column;
            }
            .footer-links {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            .footer-nav {
                justify-content: center;
            }
            .notification-panel {
                right: 10px;
                left: 10px;
                width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Card -->
        <div class="header-card">
            <div class="header-top">
                <div class="logo-section">
                    <div class="logo">QOLAE</div>
                    <div class="tagline">Secure Legal Document Management</div>
                    <div class="security-badges">
                        <div class="badge badge-secure">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9L10,17Z"/>
                            </svg>
                            Secure
                        </div>
                        <div class="badge badge-gdpr">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M9,10H7V12H9V10M13,10H11V12H13V10M17,10H15V12H17V10M19,3H18V1H16V3H8V1H6V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V8H19V19Z"/>
                            </svg>
                            GDPR Compliant
                        </div>
                        <div class="badge badge-blockchain">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12,1L8,5H11V14H13V5H16M18,23H6C4.89,23 4,22.1 4,21V9A2,2 0 0,1 6,7H9V9H6V21H18V9H15V7H18A2,2 0 0,1 20,9V21A2,2 0 0,1 18,23Z"/>
                            </svg>
                            Blockchain Secured
                        </div>
                    </div>
                </div>
                <div class="header-actions">
                    <div class="notification-bell" onclick="toggleNotifications()">
                        <svg width="24" height="24" fill="#4facfe" viewBox="0 0 24 24">
                            <path d="M21,19V20H3V19L5,17V11C5,7.9 7.03,5.17 10,4.29C10,4.19 10,4.1 10,4A2,2 0 0,1 12,2A2,2 0 0,1 14,4C14,4.1 14,4.19 14,4.29C16.97,5.17 19,7.9 19,11V17L21,19M14,21A2,2 0 0,1 12,23A2,2 0 0,1 10,21"/>
                        </svg>
                        <% if (notifications.unreadCount > 0) { %>
                        <span class="notification-badge"><%= notifications.unreadCount %></span>
                        <% } %>
                    </div>
                </div>
            </div>
            <div class="welcome-section">
                <div class="welcome-title">Welcome <%= client.name %></div>
                <div class="welcome-subtitle">Access your secure legal workflow portal. Your consent process is <%= workflow.currentStepLabel %> and all communications are encrypted.</div>
                <div class="session-info">
                    <div class="session-item">
                        <svg width="16" height="16" fill="#4facfe" viewBox="0 0 24 24">
                            <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.9L16.2,16.2Z"/>
                        </svg>
                        <span>Last login: <%= session.lastLogin %></span>
                    </div>
                    <div class="session-item">
                        <svg width="16" height="16" fill="#00b894" viewBox="0 0 24 24">
                            <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9L10,17Z"/>
                        </svg>
                        Session: Encrypted & Secure
                    </div>
                    <div class="session-item">
                        <svg width="16" height="16" fill="#667eea" viewBox="0 0 24 24">
                            <path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"/>
                        </svg>
                        Client ID: <%= client.id %>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification Panel -->
        <div class="notification-panel" id="notificationPanel">
            <div class="notification-header">
                <h3 style="margin: 0; color: #2d3748;">Notifications</h3>
                <button class="close-btn" onclick="toggleNotifications()" style="font-size: 1.5rem;">&times;</button>
            </div>
            <% notifications.items.forEach(function(notification) { %>
            <div class="notification-item <%= notification.read ? '' : 'unread' %>" onclick="markAsRead('<%= notification.id %>', this)">
                <strong style="color: #2d3748;"><%= notification.title %></strong>
                <p style="color: #6c7293; font-size: 0.9rem; margin: 5px 0;"><%= notification.message %></p>
                <div class="notification-time"><%= notification.timeAgo %></div>
            </div>
            <% }); %>
        </div>

        <!-- Progress Section -->
        <div class="progress-section">
            <div class="progress-title">Your Workflow Progress</div>
            <div class="progress-steps">
                <div class="progress-line">
                    <div class="progress-fill" data-progress="<%= progressPercentage %>"></div>
                </div>
                
                <% workflow.steps.forEach(function(step, index) { %>
                <div class="progress-step">
                    <div class="step-circle <%= step.status %>" title="<%= step.statusLabel %>">
                        <%= step.status === 'completed' ? '✓' : (index + 1) %>
                    </div>
                    <div class="step-label"><%= step.label %></div>
                </div>
                <% }); %>
            </div>
        </div>

        <!-- Cards Grid -->
        <div class="cards-grid">
            <!-- Consent Form Card -->
            <div class="workflow-card">
                <div class="card-header">
                    <div class="card-icon consent">
                        <svg fill="white" viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                    </div>
                    <div>
                        <div class="card-title">Consent Form</div>
                        <div class="status-indicator status-<%= cards.consentForm.status %>">
                            <div class="status-dot"></div>
                            <%= cards.consentForm.statusLabel %>
                        </div>
                    </div>
                </div>
                <div class="card-description">
                    Review and sign your consent form to proceed with your case. You can sign digitally within the portal or download, print, and upload the signed document.
                </div>
                <div class="card-buttons">
                    <% if (!cards.consentForm.signed) { %>
                    <button class="btn btn-primary" onclick="openSignModal()">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M9,16.2L4.8,12L3.4,13.4L9,19L21,7L19.6,5.6L9,16.2Z"/>
                        </svg>
                        Sign Digitally
                    </button>
                    <a href="./consent/download" class="btn btn-secondary">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        Download Copy
                    </a>
                    <% } else { %>
                    <a href="./consent/view" class="btn btn-secondary">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        View Signed Form
                    </a>
                    <% } %>
                </div>
            </div>

            <!-- INA Appointment Card -->
            <!-- NOTE FOR CASEMANAGERS-DASHBOARD: This appointment booking needs to sync with Case Manager's calendar -->
            <!-- When client books appointment here, it should automatically create calendar event for Case Manager -->
            <!-- Backend: POST ./appointment/schedule with blockchain timestamp -->
            <div class="workflow-card">
                <div class="card-header">
                    <div class="card-icon appointment">
                        <svg fill="white" viewBox="0 0 24 24">
                            <path d="M9,10H7V12H9V10M13,10H11V12H13V10M17,10H15V12H17V10M19,3H18V1H16V3H8V1H6V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V8H19V19Z"/>
                        </svg>
                    </div>
                    <div>
                        <div class="card-title">INA Appointment</div>
                        <div class="status-indicator status-<%= cards.inaAppointment.status %>">
                            <div class="status-dot"></div>
                            <%= cards.inaAppointment.statusLabel %>
                        </div>
                    </div>
                </div>
                <div class="card-description">
                    Your Independent Neuropsychological Assessment appointment will be scheduled once your consent form is processed. You'll receive confirmation details and preparation instructions.
                </div>
                <div class="card-buttons">
                    <% if (cards.inaAppointment.scheduled) { %>
                    <a href="./appointment/view" class="btn btn-primary">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M19,3H18V1H16V3H8V1H6V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V8H19V19Z"/>
                        </svg>
                        View Appointment
                    </a>
                    <% } else if (cards.inaAppointment.canSchedule) { %>
                    <a href="./appointment/schedule" class="btn btn-primary">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M19,3H18V1H16V3H8V1H6V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V8H19V19Z"/>
                        </svg>
                        Schedule Appointment
                    </a>
                    <% } else { %>
                    <button class="btn btn-secondary" disabled>
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M19,3H18V1H16V3H8V1H6V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V8H19V19Z"/>
                        </svg>
                        View Appointment
                    </button>
                    <% } %>
                </div>
            </div>

            <!-- Document Access Card -->
            <!-- AWAITING INFORMATION: Waiting for colleague's info about Case Management Company practices -->
            <!-- regarding client information access - this card may be refined based on that feedback -->
            <!-- Backend: Documents stored on blockchain with hash verification -->
            <div class="workflow-card">
                <div class="card-header">
                    <div class="card-icon documents">
                        <svg fill="white" viewBox="0 0 24 24">
                            <path d="M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6M13,3.5L18.5,9H13V3.5Z"/>
                        </svg>
                    </div>
                    <div>
                        <div class="card-title">Document Access</div>
                        <div class="status-indicator status-<%= cards.documentAccess.status %>">
                            <div class="status-dot"></div>
                            <%= cards.documentAccess.statusLabel %>
                        </div>
                    </div>
                </div>
                <div class="card-description">
                    Access your case documents and communications securely. Document access will be unlocked once your signed consent form is received and verified.
                </div>
                <div class="card-buttons">
                    <% if (cards.documentAccess.enabled) { %>
                    <a href="./documents" class="btn btn-primary">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M15,18V16H6V18H15M18,14V12H6V14H18Z"/>
                        </svg>
                        View Documents
                    </a>
                    <% } else { %>
                    <button class="btn btn-secondary" disabled>
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M15,18V16H6V18H15M18,14V12H6V14H18Z"/>
                        </svg>
                        View Documents
                    </button>
                    <% } %>
                </div>
            </div>

            <!-- Final Report Card -->
            <!-- Backend: Report PDFs stored on blockchain with immutable hash -->
            <div class="workflow-card">
                <div class="card-header">
                    <div class="card-icon report">
                        <svg fill="white" viewBox="0 0 24 24">
                            <path d="M14,17H7V15H14M17,13H7V11H17M17,9H7V7H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z"/>
                        </svg>
                    </div>
                    <div>
                        <div class="card-title">Final Report</div>
                        <div class="status-indicator status-<%= cards.finalReport.status %>">
                            <div class="status-dot"></div>
                            <%= cards.finalReport.statusLabel %>
                        </div>
                    </div>
                </div>
                <div class="card-description">
                    Your final assessment report will be available once the INA is completed. You'll be notified when the report is ready and can discuss findings with your legal team.
                </div>
                <div class="card-buttons">
                    <% if (cards.finalReport.available) { %>
                    <a href="./report/view" class="btn btn-primary">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        View Report
                    </a>
                    <a href="./report/download" class="btn btn-secondary">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"/>
                        </svg>
                        Download
                    </a>
                    <% } else { %>
                    <button class="btn btn-secondary" disabled>
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        View Report
                    </button>
                    <% } %>
                </div>
            </div>

            <!-- SUPPORT CARD COMMENTED OUT -->
            <!-- This card is for FUNDED Case Management clients only -->
            <!-- Uncomment and enable when client upgrades to ongoing Case Management service with 24/7 support -->
            <!-- Backend: Check client.serviceLevel === 'funded' || client.hasOngoingSupport -->
            <!--
            <% if (client.hasOngoingSupport) { %>
            <div class="workflow-card">
                <div class="card-header">
                    <div class="card-icon support">
                        <svg fill="white" viewBox="0 0 24 24">
                            <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,6C13.1,6 14,6.9 14,8C14,9.1 13.1,10 12,10C10.9,10 10,9.1 10,8C10,6.9 10.9,6 12,6M16,18H8V16C8,13.33 10.67,12 12,12C13.33,12 16,13.33 16,16V18Z"/>
                        </svg>
                    </div>
                    <div>
                        <div class="card-title">24/7 Support & Assistance</div>
                        <div class="status-indicator status-active">
                            <div class="status-dot"></div>
                            Available 24/7
                        </div>
                    </div>
                </div>
                <div class="card-description">
                    Premium support available for ongoing Case Management clients. Direct access to your Case Manager for questions, technical issues, or guidance throughout your case.
                </div>
                <div class="card-buttons">
                    <a href="./support/contact" class="btn btn-warning">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.11,4 20,4Z"/>
                        </svg>
                        Contact Support
                    </a>
                    <a href="./support/help" class="btn btn-secondary">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"/>
                        </svg>
                        Help Center
                    </a>
                </div>
            </div>
            <% } %>
            -->

        </div>

        <!-- Footer Notice -->
        <div class="footer-notice">
            <div class="notice-content">
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9L10,17Z"/>
                </svg>
                Security Notice: All data is encrypted in transit and at rest. This system is GDPR compliant and maintains strict audit trails for all actions. Documents are secured on blockchain with immutable hash verification.
            </div>
        </div>

        <!-- Footer Links -->
        <div class="footer-links">
            <div class="copyright">© <%= new Date().getFullYear() %> QOLAE. All rights reserved. Secure legal document management.</div>
            <div class="footer-nav">
                <a href="./privacy">Privacy Policy</a>
                <a href="./terms">Terms of Service</a>
                <a href="./support">Support</a>
            </div>
        </div>
    </div>

    <!-- Digital Signature Modal -->
    <div id="signModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Digital Signature</div>
                <button class="close-btn" onclick="closeSignModal()">&times;</button>
            </div>
            
            <div class="consent-form">
                <h3>Consent Form - Client Agreement</h3>
                <p><strong>Client Name:</strong> <%= client.name %></p>
                <p><strong>Case Reference:</strong> <%= client.id %></p>
                <p><strong>Date:</strong> <%= new Date().toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' }) %></p>
                <hr style="margin: 15px 0; border: none; border-top: 1px solid #e2e8f0;">
                <p>I hereby consent to participate in the Independent Neuropsychological Assessment (INA) process. I understand that:</p>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li>All information provided will be kept confidential</li>
                    <li>Assessment results will be shared with my legal team</li>
                    <li>I can withdraw consent at any time</li>
                    <li>The assessment will be conducted by qualified professionals</li>
                    <li>Reports will be completed within agreed timeframes</li>
                    <li>All documents are secured on blockchain with immutable records</li>
                </ul>
                <p style="margin-top: 15px;"><strong>Privacy & Data Protection:</strong> Your data is processed in accordance with GDPR regulations and will be stored securely on blockchain infrastructure.</p>
            </div>
            
            <div class="signature-section">
                <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #2d3748;">
                    Please sign below:
                </label>
                <canvas id="signatureCanvas" class="signature-canvas"></canvas>
                <div class="signature-controls">
                    <button class="btn btn-secondary" onclick="clearSignature()">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
                        </svg>
                        Clear
                    </button>
                </div>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="agreeCheckbox">
                <label for="agreeCheckbox">I have read and agree to the terms of this consent form</label>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="submitSignature()" style="flex: 1;">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/>
                    </svg>
                    Submit Signature
                </button>
                <button class="btn btn-secondary" onclick="closeSignModal()">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Client Data (Hidden) - passed from HR Compliance via PIN authentication -->
    <div id="clientData" style="display: none;"
         data-csrf="<%= csrfToken %>"
         data-client-id="<%= client.id %>"
         data-client-firstname="<%= client.firstName %>"
         data-first-login="<%= session.isFirstLogin %>">
    </div>

    <script>
        // Get client data from data attributes (passed from backend via HR Compliance PIN authentication)
        const clientData = document.getElementById('clientData');
        const csrfToken = clientData.dataset.csrf;
        const clientId = clientData.dataset.clientId;
        const clientFirstName = clientData.dataset.clientFirstname;
        const isFirstLogin = clientData.dataset.firstLogin === 'true';
        
        // Initialize
        let canvas, ctx, drawing = false;
        
        window.addEventListener('load', function() {
            // Apply progress bar width from data attribute
            const progressFill = document.querySelector('.progress-fill');
            const progressValue = progressFill.dataset.progress;
            progressFill.style.width = progressValue + '%';
            
            // Show welcome toast for first-time login
            if (isFirstLogin) {
                setTimeout(() => {
                    showToast('Welcome to your secure portal, ' + clientFirstName + '! 🎉', 'success');
                }, 1000);
            }
        });
        
        // Notification panel toggle
        function toggleNotifications() {
            const panel = document.getElementById('notificationPanel');
            panel.classList.toggle('show');
        }
        
        // Mark notification as read - API call to backend
        function markAsRead(notificationId, element) {
            fetch('./api/notifications/' + notificationId + '/read', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'csrf-token': csrfToken
                }
            }).then(response => {
                if (response.ok) {
                    element.classList.remove('unread');
                    updateNotificationBadge();
                }
            });
        }
        
        function updateNotificationBadge() {
            const unreadCount = document.querySelectorAll('.notification-item.unread').length;
            const badge = document.querySelector('.notification-badge');
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }
        
        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast toast-${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }
        
        // Open sign modal
        function openSignModal() {
            document.getElementById('signModal').classList.add('show');
            setTimeout(() => {
                initCanvas();
            }, 100);
        }
        
        // Close sign modal
        function closeSignModal() {
            document.getElementById('signModal').classList.remove('show');
        }
        
        // Initialize canvas for signature
        function initCanvas() {
            canvas = document.getElementById('signatureCanvas');
            ctx = canvas.getContext('2d');
            
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            ctx.strokeStyle = '#2d3748';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }
        
        function startDrawing(e) {
            drawing = true;
            ctx.beginPath();
            ctx.moveTo(e.offsetX, e.offsetY);
        }
        
        function draw(e) {
            if (!drawing) return;
            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.stroke();
        }
        
        function stopDrawing() {
            drawing = false;
        }
        
        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            
            if (e.type === 'touchstart') {
                drawing = true;
                ctx.beginPath();
                ctx.moveTo(x, y);
            } else if (e.type === 'touchmove' && drawing) {
                ctx.lineTo(x, y);
                ctx.stroke();
            }
        }
        
        function clearSignature() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            showToast('Signature cleared', 'info');
        }
        
        // Submit signature to backend via Fastify API
        function submitSignature() {
            const checkbox = document.getElementById('agreeCheckbox');
            
            if (!checkbox.checked) {
                showToast('Please agree to the terms before submitting', 'warning');
                return;
            }
            
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const hasSignature = imageData.data.some(channel => channel !== 0);
            
            if (!hasSignature) {
                showToast('Please provide your signature', 'warning');
                return;
            }
            
            // Convert canvas to blob and send to backend
            canvas.toBlob(function(blob) {
                const formData = new FormData();
                formData.append('signature', blob, 'signature.png');
                formData.append('clientId', clientId);
                formData.append('agreed', 'true');
                
                showToast('Processing your signature...', 'info');
                
                // POST to Fastify backend - blockchain timestamp will be added server-side
                fetch('./api/consent/sign', {
                    method: 'POST',
                    headers: {
                        'csrf-token': csrfToken
                    },
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        closeSignModal();
                        showToast('Consent form signed successfully! ✅', 'success');
                        
                        // Reload page to update workflow status
                        setTimeout(() => {
                            window.location.reload();
                        }, 1500);
                    } else {
                        showToast('Error signing consent form. Please try again.', 'warning');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showToast('Error signing consent form. Please try again.', 'warning');
                });
            }, 'image/png');
        }
        
        // Close modal on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('signModal');
            const notifPanel = document.getElementById('notificationPanel');
            
            if (event.target === modal) {
                closeSignModal();
            }
            
            if (!event.target.closest('.notification-panel') && !event.target.closest('.notification-bell')) {
                notifPanel.classList.remove('show');
            }
        }
    </script>
</body>
</html>